<icegrid>

<!--
    OMERO Grid Application Descriptor
    Copyright 2008 Glencoe Software, Inc.  All Rights Reserved.
    Use is subject to license terms supplied in LICENSE.txt
-->

  <application name="OMERO" import-default-templates="true">

    <variable name="OMERO_HOME"   value="."/>
    <variable name="OMEROPY_HOME" value="lib/python/"/>
    <variable name="OMEROPY_SERV" value="lib/python/omero/"/>
    <variable name="PYTHONPATH"   value="PYTHONPATH=$${PYTHONPATH}:lib/python"/>

    <properties id="Profile">
      <!--
      Any properties beginning with "omero" set here will
      be passed to the servers as if via "-Domero.example=value"
      were set on the command line. These values may be overwritten
      by `bin/omero config` values.
      -->
      <property name="omero.example"  value="my_value"/>
    </properties>

    <replica-group id="BlitzAdapters">
      <load-balancing type="adaptive" load-sample="5" n-replicas="2"/>
      <object identity="BlitzVerifier" type="::Glacier2::PermissionVerifier"/>
      <object identity="BlitzManager" type="::Glacier2::SessionManager"/>
    </replica-group>

    <replica-group id="ProcessorAdapters">
      <load-balancing type="round-robin"/>
      <object identity="Processor" type="::omero::grid::Processor"/>
    </replica-group>

    <replica-group id="TablesAdapters">
      <load-balancing type="round-robin"/>
      <object identity="Tables" type="::omero::grid::Tables"/>
    </replica-group>

    <node name="master">
      <server-instance template="Glacier2Template"
        client-endpoints="tcp -p 4063"
        session-timeout="300"
        server-endpoints="tcp -h 127.0.0.1"/>
      <server-instance template="BlitzTemplate" index="0" config="default"/>
      <server-instance template="IndexerTemplate" index="0"/>
      <server-instance template="DropBoxTemplate"/>
      <server-instance template="FSTemplate"/>
      <server-instance template="ShellTemplate" id="Web" act="on-demand"/>
      <server-instance template="StormTemplate"/>
      <!-- There should only be one of each server per host per mount.
           "" defaults to use omero.data.dir -->
      <server-instance template="RepositoryTemplate" index="0" dir=""/>
      <server-instance template="ProcessorTemplate" index="0" dir=""/>
      <server-instance template="TablesTemplate" index="0" dir=""/>
    </node>

    <node name="backup">
      <server-instance template="BlitzTemplate" index="1" config="backup"/>
    </node>

    <node name="node1">
      <server-instance template="ProcessorTemplate" index="1" dir="/OMERO"/>
    </node>

    <node name="node2">
      <server-instance template="ProcessorTemplate" index="2" dir="/OMERO"/>
    </node>

  </application>

</icegrid>
