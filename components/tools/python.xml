<?xml version="1.0" encoding="utf-8"?>
<project name="python" default="install" basedir=".">

    <property environment="py"/>
    <property name="py.DESTDIR"    value="${up-two}/target/"/>
    <property name="py.ICE_HOME"   value="/usr/share/Ice"/>
    <property name="py.ICE_CONFIG" value="${basedir}/../../blitz/target/generated/resources/local.properties"/>

    <macrodef name="setup_py">
        <element name="args" implicit="true"/>
        <sequential>
            <exec executable="${basedir}/setup.py" failonerror="true">
                <args/>
            </exec>
        </sequential>
    </macrodef>

    <macrodef name="slice_py">
        <attribute name="prefix"/>
        <attribute name="todir"/>
        <attribute name="include" default="@{todir}"/>
        <element name="files" implicit="true"/>
        <sequential>
            <apply executable="slice2py" failonerror="true"><!-- parallel="true" -->
                <arg value="--no-package"/>
                <arg value="--output-dir"/>
                <arg value="@{todir}"/>
                <arg value="--prefix"/>
                <arg value="@{prefix}"/>
                <arg value="-I@{include}"/>
                <arg value="-I${py.ICE_HOME}/slice"/>
                <files/>
            </apply>
        </sequential>
    </macrodef>

    <target name="python-build" unless="py.NOPYTHON">
        <mkdir dir="${basedir}/build/lib"/>
        <setup_py>
            <arg value="build"/>
        </setup_py>
    </target>

    <target name="python-test" unless="py.NOPYTHON">
        <setup_py>
            <arg value="test"/>
        </setup_py>
    </target>

    <target name="python-integration" unless="py.NOPYTHON">
        <setup_py>
            <env key="ICE_CONFIG" value="${py.ICE_CONFIG}"/>
            <arg value="test"/>
            <arg value="-s"/>
            <arg value="test.integration.suite"/>
        </setup_py>
    </target>

    <target name="python-install" unless="py.NOPYTHON">
        <copy todir="../target">
            <fileset dir="build" includes="**/*"/>
        </copy>
    </target>

    <target name="python-clean" unless="py.NOPYTHON">
        <setup_py>
            <arg value="clean"/>
        </setup_py>
        <delete dir="${basedir}/build"/>
        <delete dir="${basedir}/ez_setup.pyc"/>
    </target>

    <target name="findbugs">
        <echo>Not yet implemented</echo>
    </target>

</project>
