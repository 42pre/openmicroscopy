<?xml version="1.0" encoding="utf-8"?>
<project name="omerojava" default="install" basedir="." xmlns:ivy="antlib:org.apache.ivy.ant">
<!--
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#
# $Id$
#
# Copyright 2008 Glencoe Software, Inc. All rights reserved.
# Use is subject to license terms supplied in LICENSE.txt
#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
# Written by:  Josh Moore, josh at glencoesoftware.com
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

-->
    <description>
    OmeroJava interface to OmeroBlitz, provides user-friendly gateway.
    </description>

    <property name="uses.ice" value="true"/>
    <dirname property="up-two" file="${basedir}"/>
    <dirname property="up-one" file="${up-two}"/>
    <property name="import.dir"       value="${up-one}/antlib/resources"/>
    <property name="uses.ice"         value="true"/>

    <import file="${import.dir}/global.xml"/>
    <import file="${import.dir}/dependencies.xml"/>
    <import file="${import.dir}/lifecycle.xml"/>

    <defineVariables/>
    <import file="../common.xml"/>
    <target name="slice">
        <echo>no-op</echo>
    </target>

    <target name="compile" depends="generate" unless="skip.ice">
    </target>

    <target name="package" depends="generate" unless="skip.ice">
        <unjar src="${target.dir}/libs/ice.jar" dest="${target.dir}/ice-classes"/>
        <jar destfile="${target.dir}/${ivy.module}.jar">
            <fileset dir="${target.dir}/ice-classes">
                <exclude name="META-INF/**/*"/>
            </fileset>
            <fileset dir="${blitz.comp}/target/classes">
                <include name="omero/**/*.class"/>
            </fileset>
            <fileset dir="${client.comp}/target/classes">
                <include name="pojos/*.class"/>
            </fileset>
            <fileset dir="${common.comp}/target/classes">
                <include name="ome/system/UpgradeCheck.class"/>
            </fileset>
            <fileset dir="${model.comp}/target/classes">
                <include name="ome/model/IObject.class"/>
                <include name="ome/model/ModelBased.class"/>
                <include name="ome/model/internal/*.class"/>
                <include name="ome/util/Filterable.class"/>
                <include name="ome/util/Filter.class"/>
                <include name="ome/util/ModelMapper.class"/>
                <include name="ome/util/ReverseModelMapper.class"/>
            </fileset>
        </jar>
    </target>

    <target name="tools-init" unless="skip.ice"/>

    <target name="tools-build" depends="tools-init,install" description="Creates all artifacts for tools/target" unless="skip.ice"/>

    <target name="tools-dist" depends="deps-resolve,tools-build" description="Copied artifacts to tools/target" unless="skip.ice">
        <mkdir dir="${target.dir}/lib/omerojava"/>
        <ivy:publish artifactspattern="${target.dir}/[module].[ext]"
            resolver="tools-resolver" pubrevision="${omero.version}"
            publishivy="false" overwrite="true"/>
    </target>

    <target name="tools-clean" depends="clean">
	<delete dir="${basedir}/target"/>
    </target>

</project>
