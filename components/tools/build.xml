<?xml version="1.0" encoding="utf-8"?>
<project name="tools" default="help" basedir=".">

   <dirname property="up-one" file="${basedir}"/>
   <property name="import.dir" value="${up-one}/antlib/resources"/>
   <import file="${import.dir}/global.xml"/>
   
	<target name="help" description="This help message">
		<echo>
			The tools/ directory is a special repository
			for loosely coupled OMERO components. Each of
			these tools depends on a completed "dist" of
			OMERO.
		</echo>
	</target>

	<target name="build" description="Calls 'tools-build' on all components to fill target">
	  	<ant dir="${basedir}/OmeroCpp" inheritAll="false" inheritRefs="false">
			<property name="current.component" value="tools/OmeroCpp"/>
			<property name="test.with.fail" value="${test.with.fail}"/>
			<property name="test.skip" value="${test.skip}"/>
			<property name="generate.skip" value="${generate.skip}"/>
			<property name="checks.skip" value="${checks.skip}"/>
			<property name="classpath.file" value="${classpath.file}"/>
			<target name="tools-build"/>
			<target name="tools-dist"/>
		</ant>
	  	<ant dir="${basedir}/OmeroPy" inheritAll="false" inheritRefs="false">
			<property name="current.component" value="tools/OmeroPy"/>
			<property name="test.with.fail" value="${test.with.fail}"/>
			<property name="test.skip" value="${test.skip}"/>
			<property name="generate.skip" value="${generate.skip}"/>
			<property name="checks.skip" value="${checks.skip}"/>
			<property name="classpath.file" value="${classpath.file}"/>
			<target name="tools-build"/>
			<target name="tools-dist"/>
		</ant>
	  	<ant dir="${basedir}/licenses" inheritAll="false" inheritRefs="false">
			<property name="current.component" value="tools/licenses"/>
			<property name="test.with.fail" value="${test.with.fail}"/>
			<property name="test.skip" value="${test.skip}"/>
			<property name="generate.skip" value="${generate.skip}"/>
			<property name="checks.skip" value="${checks.skip}"/>
			<property name="classpath.file" value="${classpath.file}"/>
			<target name="tools-build"/>
			<target name="tools-dist"/>
		</ant>
		<ant dir="${basedir}/WebAdmin" inheritAll="false" inheritRefs="false">
			<target name="tools-build"/>
			<target name="tools-dist"/>
		</ant>
	</target>

	<target name="dist" description="Copies target onto an existing dist">
		<copy todir="../../dist" overwrite="true">
			<fileset dir="target" includes="*.war,lib/**/*,client/**/*,include/**/*" followsymlinks="false"/>
		</copy>
		<jar update="true" destfile="${dist.dir}/blitz/services.jar" basedir="${basedir}/target/service-classes" includes="**/*"/>
		<!-- This must be reworked upstream -->
		<jar update="true" destfile="${dist.dir}/omero.ear" basedir="${dist.dir}/blitz" includes="services.jar"/>
	</target>

	<target name="clean" description="Calls 'tools-clean' on all components.">
	  	<ant dir="${basedir}/OmeroCpp" inheritAll="false" inheritRefs="false">
			<property name="current.component" value="tools/OmeroCpp"/>
			<target name="tools-clean"/>
		</ant>
	  	<ant dir="${basedir}/OmeroPy" inheritAll="false" inheritRefs="false">
			<property name="current.component" value="tools/OmeroPy"/>
			<target name="tools-clean"/>
		</ant>
	  	<ant dir="${basedir}/licenses" inheritAll="false" inheritRefs="false">
			<property name="current.component" value="tools/licenses"/>
			<target name="tools-clean"/>
		</ant>
	  	<ant dir="${basedir}/WebAdmin" inheritAll="false" inheritRefs="false">
			<property name="current.component" value="tools/WebAdmin"/>
			<target name="tools-clean"/>
		</ant>
		<delete dir="${tools.dest}"/>
	</target>

</project>
