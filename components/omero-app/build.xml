<?xml version="1.0"?>

<!-- ======================================================================= -->
<!-- JBoss Deployment -->
<!-- ======================================================================= -->

<project name="jboss" default="help" basedir=".">

   <target name="help">
     <echo>
  deploy --   installs all ears under ${target.dir} to ${jboss.deploy.dir}
  undeploy -- removes those same ears from ${jboss.deploy.dir}
     </echo>
   </target>

   <dirname property="components" file="${basedir}"/>
   <import file="${components}/antlib/resources/build.xml"/>

   <property environment="env"/>
   <property name="jboss.home" value="${env.JBOSS_HOME}"/>   
   <property name="jboss.server.config" value="all"/>
   <property name="jboss.deploy.dir" value="${jboss.home}/server/${jboss.server.config}/deploy"/>

   <property name="groovy.jar" value=".m2/repository/groovy/groovy-all-1.0-jsr/04/groovy-all-1.0-jsr-04.jar"/>

   <target name="filelist">
     <path id="maven.compile.classpath">
       <pathelement location="${env.HOME}/${groovy.jar}"/>
     </path>
     <definePath/>
     <fileset dir="${target.dir}" includes="*.ear" id="ear.files"/>
   </target>

   <target name="deploy" depends="filelist">
      <copy todir="${jboss.deploy.dir}">
        <fileset refid="ear.files"/>
      </copy>
   </target>

   <target name="undeploy" depends="filelist,loadGroovy">
     <groovy>
       fs = project.references["ear.files"]
       jb = properties["jboss.deploy.dir"]
       fs.each { |file|
         ant.delete(file:"${jb}/${file}")
       }
     </groovy>
   </target>


</project>

