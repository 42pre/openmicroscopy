<project 
   xmlns:ant="jelly:ant"
   xmlns:j="jelly:core" 
>

  <postGoal name="jar:jar">
    <attainGoal name="texen"/>
  </postGoal>

  <goal name="texen">
    <ant:property name="outputDir" location="${basedir}/../model/src/generated/org/ome"/>
    <ant:property name="tmplDir"   location="${basedir}/src/templates"/>
    <ant:property name="ontology"  value="file:///${basedir}/src/conf/ome.n3.owl"/>
  
   <!-- TODO UNIX specific -->
    <ant:pathconvert targetos="unix" property="my.classpath" refid="maven.dependency.classpath"/>
    <ant:exec dir="${basedir}" executable="ant" failonerror="true">
      <ant:env key="CLASSPATH" value="${my.classpath}:${maven.build.dir}"/>     
      <ant:arg value="-DtmplDir=${tmplDir}"/>
      <ant:arg value="-DoutputDir=${outputDir}"/>
      <ant:arg value="-Dontology=${ontology}"/>
      <ant:arg value="-f"/>
      <ant:arg value="${tmplDir}/texen.xml"/>
    </ant:exec>
<!-- THIS IS HOW IT SHOULD TODO , but classpath 
<ant:ant 
        antfile="${tmpDir}/texen.xml" 
        dir="${basedir}" 
        target="generate"
        inheritAll="false"
        inheritRefs="false"
        >
    <property name="outputDir" value="${outputDir}"/>
    <property name="tmpDir" value="${tmpDir}"/>
  </ant:ant>
 -->

  </goal>

<!-- TODO THIS IS A HACK due to classpath problems -->
 <goal name="copy-jars">
  <!-- TODO replace explicit with list  <j:forEach var="dep" items="${pom.dependencies}"> -->
      <ant:copy file="${pom.getDependencyPath('velocity:velocity')}"
                      todir="${maven.build.dir}/classes/lib"/>
      <ant:copy file="${pom.getDependencyPath('ant:ant')}"
                      todir="${maven.build.dir}/classes/lib"/>
      <ant:copy file="${pom.getDependencyPath('commons-collections:commons-collections')}"
                      todir="${maven.build.dir}/classes/lib"/>
      <ant:copy file="${pom.getDependencyPath('ome-jena:commons-logging')}"
                      todir="${maven.build.dir}/classes/lib"/>
      <ant:copy file="${pom.getDependencyPath('ome-jena:antlr')}"
                      todir="${maven.build.dir}/classes/lib"/>
      <ant:copy file="${pom.getDependencyPath('ome-jena:concurrent')}"
                      todir="${maven.build.dir}/classes/lib"/>
      <ant:copy file="${pom.getDependencyPath('ome-jena:icu4j')}"
                      todir="${maven.build.dir}/classes/lib"/>
      <ant:copy file="${pom.getDependencyPath('ome-jena:jakarta-oro')}"
                      todir="${maven.build.dir}/classes/lib"/>
      <ant:copy file="${pom.getDependencyPath('ome-jena:jena')}"
                      todir="${maven.build.dir}/classes/lib"/>
      <ant:copy file="${pom.getDependencyPath('ome-jena:junit')}"
                      todir="${maven.build.dir}/classes/lib"/>
      <ant:copy file="${pom.getDependencyPath('ome-jena:log4j')}"
                      todir="${maven.build.dir}/classes/lib"/>
      <ant:copy file="${pom.getDependencyPath('ome-jena:xercesImpl')}"
                      todir="${maven.build.dir}/classes/lib"/>
      <ant:copy file="${pom.getDependencyPath('ome-jena:xml-apis')}"
                      todir="${maven.build.dir}/classes/lib"/>

<!--    </j:forEach> -->
  </goal>
</project>
