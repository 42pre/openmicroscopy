<html>
<head>
  <title>Build Tool</title>
</head>
<body>
<p>The build tool is a jar file named <i>build</i> and kept under the <i>build</i> 
  directory. Its purpose is to run a build without requiring Ant to be installed and 
  configured. The way it works is actually trivial. It contains a single class, <code>Builder</code>, 
  which is also the main class and whose <code>main</code> method simply forwards 
  the command line arguments to Ant. The manifest file links all the jar files under 
  the <i>build/tools</i> directory -- as a result, when the <i>build</i> file 
  is run, the JVM classpath will contain all those jars. Besides the external libraries 
  discussed in the previous sections, the <i>tools</i> directory also contains the 
  Ant core jars and the Ant jars for the optional tasks that we use as well as the 
  Sun JDK tools jar.</p>
<p>So the command <code>java -jar build</code> will result in invoking Ant with whatever 
  arguments follow <code>build</code> on the command line and with a classpath set 
  to contain all the jar files under <i>build/tools</i>. Because the classpath contains 
  all Ant core and optional libraries, all the external libraries, and the JDK tools, 
  all is effectively needed to run a build is a JRE -- as opposite to a whole JDK, 
  Ant, and all external libraries.</p>
<p>Even though including the JDK tools allows to build without a JDK, there's a remarkable 
  downside: the classes in the <i>build</i> jar have to be compiled under 1.4 and 
  the JDK tools jar has to be updated every time a new JDK is released. Failure to 
  do that will result in the impossibility to run the <code>compile</code> target 
  if a JRE with a newer version than the JDK tools is used.</p>
<div class="noteFrame">
  <div class="noteLabel">Note</div>
  <div class="noteContent">Compiling <code>Builder</code> under 1.4 ensures that the 
    <i>build</i> jar can be run by 1.4 JREs -- if you compile it for 1.5, then a 1.4 
    JRE won't be able to load it. Having the latest JDK tools ensures that the compiler 
    (in the JDK tools) will never find a class on its classpath with a class file 
    version (the Class File Format is discussed in the VM spec) newer than the compiler 
    version. To clarify, assume the following scenario. A JRE 1.5 is used to run the 
    build and the version of the JDK tools is 1.4. Now, the JRE bootclasspath will 
    contain classes whose (major) version is 49 but the compiler can only deal with 
    classes whose (major) version is 48 at most. So when trying to compile a class 
    the compiler will find an <code>Object</code> class (from the bootclasspath) whose 
    version is 49.0 and will error.</div>
</div>
<p>The <code>Builder</code> class and the <i>build</i> jar itself are generated by 
  an Ant build file: the <i>build.xml</i> file under the <i>build/tools</i> directory. 
  You can refer to the inline documentation in this file for further details on the 
  build tool. One thing to keep in mind is that the <i>build</i> jar has to be regenerated 
  every time a new library is added to the <i>tools</i> directory. In fact, the manifest 
  file has to be updated to link to the new library.</p>
<p>&#160;</p>
<div class="noteFrame">
  <div class="noteLabel">Note</div>
  <div class="noteContent">The <i>tools</i> directory also contains two XSL files. 
    These are the stylesheets used by the <code>junitreport</code> task to make test 
    reports. The reason why we're not using the embedded files that come with the 
    task is that the Xalan <code>redirect</code> declared in these files doesn't work 
    with some (nasty) configurations of JRE/Xalan. So we stripped those files out 
    and changed the <code>redirect</code> statement.</div>
</div>
</body>
</html>

